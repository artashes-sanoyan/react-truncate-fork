/**
 * name: react-truncate-fork
 * version: v0.4.3
 * description: Provides `Truncate`, `MiddleTruncate` and `ShowMore` React components for truncating multi-line spans and adding an ellipsis.
 * author: chengpeiquan <chengpeiquan@chengpeiquan.com>
 * homepage: https://truncate.js.org
 * license: MIT
 */
import R,{useCallback as A,useEffect as B,useMemo as O,useRef as $,useState as J}from"react";import q from"react";var _=e=>e?.offsetWidth,G=e=>e.replace(/\s+$/,""),ee=(e,t,n)=>{if(t===n.length-1)return q.createElement("span",{key:t},e);{let o=q.createElement("br",{key:`${t}br`});return e?[q.createElement("span",{key:t},e),o]:o}},te=(e,t)=>{let n=document.createElement("div"),o="innerText"in window.HTMLElement.prototype?"innerText":"textContent";n.innerHTML=e?.innerHTML.replace(/\r\n|\r|\n/g,t)||"";let i=n[o],s=document.createElement("div");return s.innerHTML="foo<br/>bar",s[o]?.replace(/\r\n|\r/g,`
`)!==`foo
bar`&&(n.innerHTML=n.innerHTML.replace(/<br.*?[/]?>/gi,`
`),i=n[o]),i||""},ne=({end:e,lastLineText:t,fullText:n,targetWidth:o,ellipsisWidth:i,measureWidth:s})=>{let c=t.length,g=Math.abs(e),l=g>c?0:c-g,p=t.slice(0,l),u=l===0?-c:e,h=n.slice(u),v=s(p)+s(h)+i;for(;v>o;)p=p.slice(0,p.length-1),v=s(p)+s(h)+i;return{startFragment:p,endFragment:h}};var X=({children:e,ellipsis:t="...",lines:n=1,trimWhitespace:o=!1,width:i=0,separator:s=" ",middle:c=!1,end:g=5,onTruncate:l,...p})=>{let[u,h]=J(),[v,F]=J(),[m,M]=J(0),[k,z]=J(0),y=$(null),f=$(null),L=$(null);B(()=>{f&&f.current&&f.current.parentNode&&f.current.parentNode.removeChild(f.current)},[m]);let S=A(()=>{if(!y.current?.parentElement)return;let r=i||Math.floor(y.current.parentElement.getBoundingClientRect().width);if(!r)return window.requestAnimationFrame(()=>S());let a=window.getComputedStyle(y.current),P=[a.fontWeight,a.fontStyle,a.fontSize,a.fontFamily].join(" ");u&&(u.font=P,u.letterSpacing=a.letterSpacing),M(r)},[u,i]);B(()=>{let r=document.createElement("canvas");h(r.getContext("2d"))},[]),B(()=>(S(),window.addEventListener("resize",S),()=>{window.removeEventListener("resize",S),window.cancelAnimationFrame(k)}),[S,k]);let j=A(r=>{typeof l=="function"&&z(window.requestAnimationFrame(()=>{l(r)}))},[l]),W=A(r=>u?.measureText(r).width||0,[u]),Q=O(()=>!Number.isSafeInteger(n)||n<0?0:n,[n]),C=O(()=>c?1:Q,[Q,c]),D=O(()=>{let r=Math.abs(g),a=Number.isFinite(r)?Math.floor(r):0;return a>0?-a:a},[g]),U=A(()=>{let r=[],a=te(f.current,s),P=a.split(`
`).map(b=>b.split(s)),Y=_(L.current)||0,Z=!0;for(let b=1;b<=C;b++){let H=P[0];if(H.length===0){r.push(),P.shift(),b--;continue}let N=H.join(s)||"";if(W(N)<=m&&P.length===1){Z=!1,r.push(N);break}if(b===C){let d=H.join(s),T=0,E=d.length-1;for(;T<=E;){let x=Math.floor((T+E)/2),V=d.slice(0,x+1);W(V)+Y<=m?T=x+1:E=x-1}let w=d.slice(0,T);if(o)for(w=G(w);!w.length&&r.length;){let x=r.pop();x&&typeof x=="string"&&(w=G(x))}if(c&&D!==0){let{startFragment:x,endFragment:V}=ne({end:D,lastLineText:w,fullText:a,targetWidth:m,ellipsisWidth:Y,measureWidth:W});N=R.createElement("span",null,x,t,V)}else N=R.createElement("span",null,w,t)}else{let d=0,T=H.length-1;for(;d<=T;){let E=Math.floor((d+T)/2),w=H.slice(0,E+1).join(s);W(w)<=m?d=E+1:T=E-1}if(d===0){b=C-1;continue}N=H.slice(0,d).join(s),P[0].splice(0,d)}r.push(N)}return j(Z),r},[s,j,C,W,m,o,D,c,t]);return B(()=>{let r=!!(y.current&&m);typeof window<"u"&&r&&(C>0?F(U().map(ee)):(F(e),j(!1)))},[e,C,m,U,j]),R.createElement("span",{...p,ref:y},R.createElement("span",null,v),R.createElement("span",{ref:f},e),R.createElement("span",{ref:L,style:{position:"fixed",visibility:"hidden",top:0,left:0}},t))};import re,{forwardRef as le,useCallback as ae,useEffect as ce,useState as pe}from"react";var ue=le(({children:e,onTruncate:t,...n},o)=>{let{width:i,middle:s,lines:c,...g}=n,[l,p]=pe(!1),u=ae(h=>{h!==l&&p(h)},[l]);return ce(()=>{typeof t=="function"&&t(l)},[t,l]),re.createElement("div",{ref:o,style:{width:"100%"}},re.createElement(X,{...g,middle:!0,onTruncate:u},e))});ue.displayName="MiddleTruncate";import I,{forwardRef as de,useCallback as se,useEffect as ge,useImperativeHandle as he,useMemo as xe,useState as ie}from"react";import oe,{isValidElement as fe,useMemo as me}from"react";var K=({type:e,label:t,className:n,toggleLines:o})=>{let i=me(()=>e==="more"?"... ":" ",[e]);return fe(t)?t:oe.createElement("span",null,i,oe.createElement("a",{href:"#",className:n,onClick:o},t))};var Te=de(({lines:e=3,more:t="Expand",less:n="Collapse",anchorClass:o,onToggle:i,children:s,...c},g)=>{let{width:l,middle:p,end:u,ellipsis:h,...v}=c,[F,m]=ie(!1),[M,k]=ie(!1),z=xe(()=>M?0:e,[M,e]),y=se(L=>{L!==F&&m(L)},[F]),f=se(L=>{L.preventDefault(),k(S=>!S)},[]);return he(g,()=>({toggleLines:f})),ge(()=>{typeof i=="function"&&i(M)},[M,i]),I.createElement("div",{style:{width:"100%"}},I.createElement(X,{...v,lines:z,ellipsis:I.createElement(K,{type:"more",label:t,className:o,toggleLines:f}),onTruncate:y},s),!F&&M&&I.createElement(K,{type:"less",label:n,className:o,toggleLines:f}))});Te.displayName="ShowMore";export{ue as MiddleTruncate,Te as ShowMore,X as Truncate};
